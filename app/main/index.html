<template>
    <div class="page">

        <!-- <div class="navbar">
            <div class="navbar-inner">
                <img class="theme-light-only" src="assets/custom/img/konbini-logo.svg" height="24" alt="" />
            </div>
        </div> -->

        <div class="toolbar tabbar tabbar-labels">
            <div class="toolbar-inner">
                <a href="/" class="tab-link" data-route-tab-id="tab-home">
                    <i class="icon material-icons">home</i>
                    <span class="tabbar-label">Home</span>
                </a>
                <a href="/tab-order/" class="tab-link" data-route-tab-id="tab-order">
                    <i class="icon material-icons">shopping_cart</i>
                    <span class="tabbar-label">Order</span>
                </a>
                <a href="/tab-transaction/" class="tab-link" data-route-tab-id="tab-transaction">
                    <i class="icon material-icons">history</i>
                    <span class="tabbar-label">Order history</span>
                </a>
                <a href="/tab-inbox/" class="tab-link" data-route-tab-id="tab-inbox">
                    <i class="icon material-icons">email<span class="badge color-red">{{inboxNumber}}</span></i>
                    <span class="tabbar-label">Inbox</span>
                </a>
                <a href="/tab-more/" class="tab-link" data-route-tab-id="tab-more">
                    <i class="icon material-icons">more_vert</i>
                    <span class="tabbar-label">More</span>
                </a>
            </div>
        </div>
        <!-- Additional "tabs-routable" is required on tabs -->
        <div class="tabs tabs-routable">
            <div class="tab page-content" id="tab-home"></div>
            <div class="tab page-content" id="tab-order"></div>
            <div class="tab page-content" id="tab-transaction"></div>
            <div class="tab page-content" id="tab-inbox"></div>
            <div class="tab page-content" id="tab-more"></div>
        </div>
    </div>
</template>
<style scoped>
</style>
<script>
    return {
        data: function () {
            return {
                inboxResult: null,
                inboxNumber: 0
            }
        },
        methods: {
            logout: function () {
                var self = this;
                localStorage.removeItem('WOKPPL_OldUser');
                localStorage.removeItem('WOKPPL_accessToken');
                localStorage.removeItem('WOKPPL_expireInSeconds');
                localStorage.removeItem('WOKPPL_expired');
                localStorage.removeItem('WOKPPL_refreshToken');
                localStorage.removeItem('WOKPPL_mobile');
                localStorage.removeItem('WOKPPL_name');
                localStorage.removeItem('WOKPPL_email');
                localStorage.removeItem('WOKPPL_username');
                localStorage.removeItem('WOKPPL_userId');
                localStorage.removeItem('WOKPPL_passcode');
                localStorage.removeItem('addProduct');
                localStorage.removeItem('cartItems');
                localStorage.removeItem('listOrderSession');
                localStorage.removeItem('listOrderDate');
                localStorage.removeItem('categories');
                localStorage.removeItem('editProduct');
                localStorage.removeItem('sessions');
            }
        },
        on: {
            pageInit: function () {
                var self = this;
                localStorage.removeItem('WOKPPL_password');
                localStorage.removeItem('WOKPPL_registerSuccess');
                // $('#tab-order').on('tab:show', function () {
                //     app.views.current.router.refreshPage();
                // });
                // app.request.get(window.config.url + 'api/services/app/Session/GetCurrentLoginInformations',
                //     function (suc) {
                //         let response = JSON.parse(suc)
                //         if (response.result.user == null) self.logout();
                //     },
                //     function (err) {
                //         console.log(err)
                //     })
                setTimeout(function () {
                    if (!localStorage.getItem('WOKPPL_OldUser')) {
                        console.log('main')
                        app.views.current.router.navigate('/signin');
                    };
                }, 0);

                console.log('index')
                app.request.get(window.config.url + 'api/services/app/Notification/GetUserNotifications',
                {MaxResultCount: 1000},
                function (suc){
                    let response = JSON.parse(suc);
                    //console.log('inbox', response); 
                    self.$setState({
                        //inboxResult : response.result,
                        inboxNumber : response.result.unreadCount
                    }) 
                },
                function (err){
                    console.log(err)
                })
            },
            pageAfterIn() {
                var self = this;
                app.views.main.router.clearPreviousHistory();
            },
        }
    }
</script>