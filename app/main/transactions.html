<template>
    <div class="page">
        <div class="navbar">
            <div class="navbar-inner">
                <img class="theme-light-only" src="assets/custom/img/konbini-logo.svg" height="24" alt="" />
            </div>
        </div>
        <div class="page-content" style="padding-top: 44px;">
            <div class="block">
                <div class="row">
                    <div class="col-25">
                        <div class="item-inner">
                            <div class="item-title item-label">From Date</div>
                            <div class="item-input-wrap">
                                <input type="date" name="fromDate" value="{{startDate}}" />
                            </div>
                        </div>
                    </div>
                    <div class="col-25">
                        <div class="item-inner">
                            <div class="item-title item-label">To Date</div>
                            <div class="item-input-wrap">
                                <input type="date" name="toDate" value="{{endDate}}" />
                            </div>
                        </div>
                    </div>
                    <div class="col-25">
                        <div class="item-inner">
                            <button type="button" @click=search()
                                class="button button-small button-round button-fill">Search</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="list">
                <div class="list-group">
                    <ul>
                        <li class="list-group-title">11-2019</li>
                        <li>
                            <a href="/transactions-detail" @click="getId(1)" class="item-link">
                                <div class="item-content">
                                    <div class="item-media">
                                        <i class="fa-stack">
                                            <span class="fas fa-circle fa-stack-2x text-color-red"></span>
                                            <span class="fas fa-shopping-cart fa-stack-1x fa-inverse"></span>
                                        </i>
                                    </div>
                                    <div class="item-inner">
                                        <div class="item-title">
                                            <span>Order Id</span>
                                            <div class="item-header">
                                                13/11/2019 09:21
                                            </div>
                                        </div>
                                        <div class="item-title">
                                            <div class="item-header text-color-red">
                                                SGD -1.00
                                            </div>
                                            <span class="badge color-green">Success</span>
                                        </div>
                                    </div>
                                </div>
                            </a>
                        </li>
                        <li>
                            <a href="/transactions-detail" @click="getId(1)" class="item-link">
                                <div class="item-content">
                                    <div class="item-media">
                                        <i class="fa-stack">
                                            <span class="fas fa-circle fa-stack-2x text-color-red"></span>
                                            <span class="fas fa-shopping-cart fa-stack-1x fa-inverse"></span>
                                        </i>
                                    </div>
                                    <div class="item-inner">
                                        <div class="item-title">
                                            <span>Order Id</span>
                                            <div class="item-header">
                                                13/11/2019 09:21
                                            </div>
                                        </div>
                                        <div class="item-title">
                                            <div class="item-header text-color-green">
                                                SGD +1.00
                                            </div>
                                            <span class="badge color-green">Success</span>
                                        </div>
                                    </div>
                                </div>
                            </a>
                        </li>
                        <li>
                            <a href="/transactions-detail" @click="getId(1)" class="item-link">
                                <div class="item-content">
                                    <div class="item-media">
                                        <i class="fa-stack">
                                            <span class="fas fa-circle fa-stack-2x text-color-red"></span>
                                            <span class="fas fa-shopping-cart fa-stack-1x fa-inverse"></span>
                                        </i>
                                    </div>
                                    <div class="item-inner">
                                        <div class="item-title">
                                            <span>Order Id</span>
                                            <div class="item-header">
                                                13/11/2019 09:21
                                            </div>
                                        </div>
                                        <div class="item-title">
                                            <div class="item-header text-color-red">
                                                SGD -1.00
                                            </div>
                                            <span class="badge color-green">Success</span>
                                        </div>
                                    </div>
                                </div>
                            </a>
                        </li>
                        <li class="list-group-title">10-2019</li>
                        <li>
                            <a href="/transactions-detail" @click="getId(1)" class="item-link">
                                <div class="item-content">
                                    <div class="item-media">
                                        <i class="fa-stack">
                                            <span class="fas fa-circle fa-stack-2x text-color-red"></span>
                                            <span class="fas fa-shopping-cart fa-stack-1x fa-inverse"></span>
                                        </i>
                                    </div>
                                    <div class="item-inner">
                                        <div class="item-title">
                                            <span>Order Id</span>
                                            <div class="item-header">
                                                13/11/2019 09:21
                                            </div>
                                        </div>
                                        <div class="item-title">
                                            <div class="item-header text-color-red">
                                                SGD -1.00
                                            </div>
                                            <span class="badge color-green">Success</span>
                                        </div>
                                    </div>
                                </div>
                            </a>
                        </li>
                        <li>
                            <a href="/transactions-detail" @click="getId(1)" class="item-link">
                                <div class="item-content">
                                    <div class="item-media">
                                        <i class="fa-stack">
                                            <span class="fas fa-circle fa-stack-2x text-color-red"></span>
                                            <span class="fas fa-shopping-cart fa-stack-1x fa-inverse"></span>
                                        </i>
                                    </div>
                                    <div class="item-inner">
                                        <div class="item-title">
                                            <span>Order Id</span>
                                            <div class="item-header">
                                                13/11/2019 09:21
                                            </div>
                                        </div>
                                        <div class="item-title">
                                            <div class="item-header text-color-green">
                                                SGD +1.00
                                            </div>
                                            <span class="badge color-green">Success</span>
                                        </div>
                                    </div>
                                </div>
                            </a>
                        </li>
                        <li>
                            <a href="/transactions-detail" @click="getId(1)" class="item-link">
                                <div class="item-content">
                                    <div class="item-media">
                                        <i class="fa-stack">
                                            <span class="fas fa-circle fa-stack-2x text-color-red"></span>
                                            <span class="fas fa-shopping-cart fa-stack-1x fa-inverse"></span>
                                        </i>
                                    </div>
                                    <div class="item-inner">
                                        <div class="item-title">
                                            <span>Order Id</span>
                                            <div class="item-header">
                                                13/11/2019 09:21
                                            </div>
                                        </div>
                                        <div class="item-title">
                                            <div class="item-header text-color-red">
                                                SGD -1.00
                                            </div>
                                            <span class="badge color-green">Success</span>
                                        </div>
                                    </div>
                                </div>
                            </a>
                        </li>
                        <li>
                            <a href="/transactions-detail" @click="getId(1)" class="item-link">
                                <div class="item-content">
                                    <div class="item-media">
                                        <i class="fa-stack">
                                            <span class="fas fa-circle fa-stack-2x text-color-red"></span>
                                            <span class="fas fa-shopping-cart fa-stack-1x fa-inverse"></span>
                                        </i>
                                    </div>
                                    <div class="item-inner">
                                        <div class="item-title">
                                            <span>Order Id</span>
                                            <div class="item-header">
                                                13/11/2019 09:21
                                            </div>
                                        </div>
                                        <div class="item-title">
                                            <div class="item-header text-color-red">
                                                SGD -1.00
                                            </div>
                                            <span class="badge color-green">Success</span>
                                        </div>
                                    </div>
                                </div>
                            </a>
                        </li>
                        <li>
                            <a href="/transactions-detail" @click="getId(1)" class="item-link">
                                <div class="item-content">
                                    <div class="item-media">
                                        <i class="fa-stack">
                                            <span class="fas fa-circle fa-stack-2x text-color-red"></span>
                                            <span class="fas fa-shopping-cart fa-stack-1x fa-inverse"></span>
                                        </i>
                                    </div>
                                    <div class="item-inner">
                                        <div class="item-title">
                                            <span>Order Id</span>
                                            <div class="item-header">
                                                13/11/2019 09:21
                                            </div>
                                        </div>
                                        <div class="item-title">
                                            <div class="item-header text-color-green">
                                                SGD +1.00
                                            </div>
                                            <span class="badge color-green">Success</span>
                                        </div>
                                    </div>
                                </div>
                            </a>
                        </li>
                        <li>
                            <a href="/transactions-detail" @click="getId(1)" class="item-link">
                                <div class="item-content">
                                    <div class="item-media">
                                        <i class="fa-stack">
                                            <span class="fas fa-circle fa-stack-2x text-color-red"></span>
                                            <span class="fas fa-shopping-cart fa-stack-1x fa-inverse"></span>
                                        </i>
                                    </div>
                                    <div class="item-inner">
                                        <div class="item-title">
                                            <span>Order Id</span>
                                            <div class="item-header">
                                                13/11/2019 09:21
                                            </div>
                                        </div>
                                        <div class="item-title">
                                            <div class="item-header text-color-red">
                                                SGD -1.00
                                            </div>
                                            <span class="badge color-green">Success</span>
                                        </div>
                                    </div>
                                </div>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</template>
<style>
.fa-stack {
    width: 2em;
}
</style>
<script>
    return {
        data: function () {
            return {
                transactions: null,
                items: null,
                totalCount: 0,
                startDate: '2000-01-01',
                endDate: '2099-12-31',
            }
        },
        methods: {
            loadData: function (startDate, endDate) {
                var self = this;
                app.request.getJSON(window.config.url + 'api/services/app/Transaction/GetAllTransactions?StartDate=' + startDate + '&&EndDate=' + endDate,
                    function (suc) {
                        self.$setState({
                            transactions: suc.result.items,
                            totalCount: suc.result.totalCount,
                            items: self.groupItems(suc.result.items)
                        });
                        console.log(self.items)
                    },
                    function (err) {
                        console.log(err)
                    })
            },
            groupItems: function (list) {
                list.forEach(element => {
                    // get time offset from browser
                    var currentDate = new Date();
                    var offset = -(currentDate.getTimezoneOffset() / 60);
                    // get provided date
                    let givenDate = new Date(element.creationTime);
                    // apply offset
                    var hours = givenDate.getHours();
                    hours += offset;
                    givenDate.setHours(hours);
                    // format the date
                    element.creationTime = ("0" + givenDate.getDate()).slice(-2) + '/' + ("0" + (givenDate.getMonth() + 1)).slice(-2) + '/' + givenDate.getFullYear() + ' ' + ("0" + givenDate.getHours()).slice(-2) + ':' + ("0" + givenDate.getMinutes()).slice(-2);
                    //convert amount: cent>>dollar
                    element.amount = element.amount / 100;
                });

                result = list.reduce(function (r, a) {
                    r[a.creationTime.substr(3, 7)] = r[a.creationTime.substr(3, 7)] || [];
                    r[a.creationTime.substr(3, 7)].push(a);
                    return r;
                }, Object.create(null));

                return result;
            },
            search: function () {
                var self = this;
                self.loadData(self.startDate, self.endDate)
            },
            getId: function (id) {
                var self = this;
                console.log(id)
            }
        },
        mounted() {
            var self = this;
            let dt = new Date();
            self.endDate = dt.toISOString().substr(0, 10);
            let dat = new Date();
            dat.setDate(1);
            self.startDate = dat.toISOString().substr(0, 10);
        }
    }
</script>