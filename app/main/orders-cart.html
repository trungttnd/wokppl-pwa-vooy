<template>
    <div class="page">
        <div class="navbar">
            <div class="navbar-inner">
                <img class="theme-light-only" src="assets/custom/img/konbini-logo.svg" height="24" alt="" />
                <div class="right">
                    <a href="/orders-cart" class="link icon-only">
                        <i class="icon material-icons">shopping_cart<span
                                class="badge color-red">{{quantity}}</span></i></a>
                    <span class="text-color-red">${{total.toFixed(2)}}</span>
                </div>
            </div>
        </div>

        <div class="page-content">
            <div class="block text-align-left">
                <div class="cart-name">Order Details:</div>
                <div class="detail-box">
                    <div class="order-date">
                        Order Date: {{listOrderDate}} 
                    </div>
                    <div class="session">
                        Session: {{orderSessionName}}
                    </div>
                    <div class="collection-time">
                        Collection Time: {{orderSessionTime}}
                    </div>
                </div>
            </div>
            <div class="content-block block-card text-align-left">
                <div class="your-cart">Your Cart:</div>
            </div>
            <div class="card">
                <div class="list media-list no-hairlines no-hairlines-between margin-vertical descriptionFont">
                    <ul>
                        {{#if productList}}
                        {{#each productList}}
                        <li>
                            <div class="item-content">
                                <div class="item-media"><img
                                        src="https://wokpplapi.konbi.cloud/uploads/{{this.imageFileName}}"
                                        width="80" /></div>
                                <div class="item-inner">
                                    <div class="item-title-row">
                                        <div class="item-title">{{this.name}}</div>
                                        <div class="item-title">
                                            ${{this.price}} x {{this.quantity}}</div>
                                    </div>
                                    <div class="item-text">
                                        <div class="row">
                                            <div class="col-75">
                                                <div class="item-cell">
                                                    {{#each this.modifierGroups}}
                                                    <div class="item-row">
                                                        {{this.name}}: {{#each this.modifiers}} {{#if this.isChoose}} {{this.name}} {{/if}} {{/each}}
                                                    </div>
                                                    {{/each}}
                                                </div>
                                            </div>
                                            <div class="col-25">
                                                <div class="item-cell">
                                                    <div class="item-row">
                                                        &nbsp;
                                                    </div>
                                                    <div class="item-row" style="color: red;">
                                                        <a href="#" @click="editProduct('{{this.indexProduct}}')" class="item-link tooltip-init"
                                                            data-tooltip="Edit Your Cart">
                                                            <i class="fas fa-fw fa-lg fa-edit text-color-red"></i></a>
                                                        <a href="#" @click="deleteProduct('{{this.indexProduct}}')" class="item-link tooltip-init"
                                                            data-tooltip="Remove from Cart">
                                                            <i class="fas fa-fw fa-lg fa-trash text-color-red"></i></a>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                        </li>
                        {{/each}}
                        {{/if}}
                    </ul>
                </div>
            </div>

            <div class="card">
                <div class="card-content card-content-padding">
                    <div class="list no-hairlines no-hairlines-between">
                        <ul>
                            <li>
                                <div class="item-content">
                                    <div class="item-inner">
                                        <div class="item-title">Subtotal</div>
                                        <div class="item-after">${{total}}</div>
                                    </div>
                                </div>
                            </li>
                            <li>
                                <div class="item-content">
                                    <div class="item-inner">
                                        <div class="item-title">Reward points
                                                <div class="item-text">You have 930 points (SGD $10) to redeem</div>
                                        </div>
                                        <div class="item-after">
                                            <label class="toggle toggle-init color-pink tooltip-init" data-tooltip="Redeem">
                                                <input type="checkbox" data-permission="redeem" />
                                                <span class="toggle-icon"></span>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </li>
                            <li>
                                <div class="item-content">
                                    <div class="item-inner">
                                        <div class="item-title">Discount</div>
                                        <div class="item-after">$0.00</div>
                                    </div>
                                </div>
                            </li>
                            <li>
                                <div class="item-content">
                                    <div class="item-inner">
                                        <div class="item-title">GST</div>
                                        <div class="item-after">$0.00</div>
                                    </div>
                                </div>
                            </li>
                            <li>
                                <div class="item-content">
                                    <div class="item-inner">
                                        <div class="item-title"><b>Grand Total</b></div>
                                        <div class="item-after"><b>$34.50</b></div>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="block">
                &nbsp;
            </div>
        </div>
        <div class="fab fab-right-top color-orange">
            <a href="/tab-order/" class="link back" @click="closeButton()">
                <i class="icon material-icons">close</i>
            </a>
        </div>
        <div class="fab fab-extended fab-center-bottom color-red" style="width: 120px;">
            <a href="/orders-checkout">
                <span style="font-family: cabin regular;">CHECKOUT</span>
            </a>
        </div>
        <div class="fab fab-morph fab-right-bottom color-orange">
            <a href="#" @click="clearProduct()">
                <span style="font-family: cabin regular;">Clear</span>
            </a>
        </div>
    </div>
</template>

<style scoped>
    .cart-name {
        font-size: 28px;
        font-weight: bold;
        letter-spacing: 0.5px;
        margin-top: 0px;
    }
    .detail-box {
        font-size: 18px;
        margin-top: 10px;
        background-color: lightgray;
        border: 1px;
        padding: 7px;
    }
    .your-cart {
        font-size: 28px;
        font-weight: bold;
        letter-spacing: 0.5px;
        margin-top: 0px;
        padding-left: 15px;
    }
</style>

<script>
    return {
        data: function () {
            return {
                quantity: 0,
                total: 0,
                productList: [
                ],
                listOrderDate: null,
                listOrderSession: null,
                orderSessionName: null,
                orderSessionTime: null,
                listOption: [],
                updateCartList: [],
            }
        },
        methods: {
            deleteProduct: function (indexProduct) {
                var self = this;
                console.log(self.updateCartList);
                for (let i = 0; i < self.updateCartList.items.length; i++){
                    if (self.updateCartList.items[i].indexProduct == indexProduct){
                        self.updateCartList.quantity = self.updateCartList.quantity - self.updateCartList.items[i].quantity;
                        self.updateCartList.total = self.updateCartList.total - self.updateCartList.items[i].price*self.updateCartList.items[i].quantity;
                        self.updateCartList.items.splice(i, 1);
                    }
                }
                console.log(self.updateCartList);
                localStorage.setItem('cartItems', JSON.stringify(self.updateCartList));
                let cartTemp = JSON.parse(localStorage.getItem('cartItems'));
                self.$setState({
                    updateCartList: cartTemp,
                    productList: cartTemp.items,
                    quantity: cartTemp.quantity,
                    total: cartTemp.total,
                })
            },
            clearProduct: function (indexProduct) {
                var self = this;
                console.log(self.updateCartList);
                self.updateCartList.items.splice(0, self.updateCartList.items.length);
                self.updateCartList.quantity = 0;
                self.updateCartList.total = 0;
                console.log(self.updateCartList);
                localStorage.setItem('cartItems', JSON.stringify(self.updateCartList));
                let cartTemp = JSON.parse(localStorage.getItem('cartItems'));
                self.$setState({
                    updateCartList: cartTemp,
                    productList: cartTemp.items,
                    quantity: cartTemp.quantity,
                    total: cartTemp.total,
                })
            },
            editProduct: function (indexProduct) {
				var self = this;
                
                var isEdit = true;
				// //let orderDate = $('#date').val();
				// //let orderSession = self.$('select[name=session]').val();
				// //console.log(id);
				let det = self.productList.find(function (el) {
					return el.indexProduct == indexProduct;
                })
                // for (let i = 0; i < self.productList.length; i++){
                //     if (self.productList[i].id == id && self.productList[i].indexProduct == i){
                //         det = self.productList[i];
                //     }
                // }
                console.log(det)
                det.editornew = true;
                localStorage.setItem('isEdit', isEdit);
                localStorage.setItem('editProduct', JSON.stringify(det));
                localStorage.setItem('cartItems', JSON.stringify(self.updateCartList));
				// // self.$setState({
				// // 	detail: det,
				// // 	tempQuantity: self.tempQuantity + 1,
				// // })
				// //console.log(self.detail)
				// // self.listOrderDate = orderDate;
				// // for (let i = 0; i < self.session.length; i++){
				// // 	if (orderSession == self.session[i].id){
				// // 		self.listOrderSession = self.session[i];
				// // 	}
				// // }
				// // localStorage.setItem('listOrderDate', JSON.stringify(self.listOrderDate));
				// // localStorage.setItem('listOrderSession', JSON.stringify(self.listOrderSession));
				app.views.current.router.navigate('/orders-options');
            },
            closeButton: function (){
                localStorage.removeItem('isEdit');
            },
        },
        on: {
            pageInit: function () {
                var self = this;
                let cartTemp = JSON.parse(localStorage.getItem('cartItems'));
                let tempString = [];
                for (let i = 0; i < cartTemp.items.length; i++){
                    cartTemp.items[i].editornew = false;
                    cartTemp.items[i].indexProduct = i + '-' + cartTemp.items[i].id;
                }
                if (cartTemp != null){
                    self.$setState({
                        updateCartList: cartTemp,
                        productList: cartTemp.items,
                        quantity: cartTemp.quantity,
                        total: cartTemp.total,
                        listOrderDate: cartTemp.listOrderDate,
                        listOrderSession: cartTemp.listOrderSession,
                        orderSessionName: cartTemp.listOrderSession.name,
                        orderSessionTime: cartTemp.listOrderSession.startTime + " - " + cartTemp.listOrderSession.endTime,
                    })
                }
            }
        }
    }
</script>